<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Twister</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="css/Principale.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- <script src="main.js"></script> -->
</head>
<script type="text/javascript">
    //Objet Message
    function Message(id , auteur , texte , comments , date){
        this.id = id;
        this.auteur=auteur;
        this.date=date;
        this.texte=texte;
        if(comments == undefined){
            comments=[];}
        this.comments=comments;
    }
    Message.prototype.getHTML = function(){
        s="<div id=\"message_"+this.id+"\" class=\"msg\">\n"+
            "<div>\n<div>"+this.auteur.getHTML()+"</div>\n<div>"+this.date+"</div>\n</div>\n"+
            "<div>"+this.texte+"</div>"+
            "<div>";
        for(var i =0 ; i<this.comments.length ; i++){
            s+="<div>"+this.comments[i].getHTML()+"</div>"
        }
        s+="</div></div>";
        return s;
    }

    //objet commentaire
    function Commentaire(id , auteur , texte , date){
        this.id = id;
        this.auteur=auteur;
        this.date=date;
        this.texte=texte;
    }
    Commentaire.prototype.getHTML = function(){
        s="<div id=\"commentaire_"+this.id+"\">"+
            "<div><div>"+this.auteur.getHTML()+"</div><div>"+this.date+"</div></div>"+
            "<div>"+this.texte+"</div>"+
            "</div>";
        return s;
    }

    //objet Auteur
    function Auteur(id , login){
        this.id = id;
        this.login=login;
    }
    Auteur.prototype.getHTML = function(){
        s="<div id=\"auteur_"+this.id+"\">"+
            "<div>"+this.login+"</div>"+
            "</div>";
        return s;
    }

    //fonction du parser
    revival=function(key , value){
        if(!value.comments == undefined){
            return new Message(value.id , valu.auteur, value.texte , value.date , value.comments);
        }
        else if(value.texte != undefined){
            return new Commentaire(value.id , value.auteur ,value.texte, value.date);
        }
        if(key=="auteur"){
            return new Auteur(value.id , value.login);
        }
        if(key=="date"){
            return new date(value.date);
        }
    }

    function setVirtualdb(){
        localdb= []
        follows = []
        /*var u1 = {"id":1 , "login":"toto"}
        var u2 = {"id":2 , "login":"titi"}
        var u3 = {"id":3 , "login":"jordan"}*/

        var u1 = new Auteur(1, "toto");
        var u2 = new Auteur(2, "tata");
        var u3 = new Auteur(3, "jordan");

        follows[1] = new Set()
        follows[1].add(2)
        follows[2] = new Set()
        follows[2].add(3)
        follows[3] = new Set()
        follows[3].add(1)

        com1 = new Commentaire(1, u2, "Comment ca va", new Date());
        com2 =  new Commentaire(2, u3, "Ca va bien", new Date());

        msg = new Message( 1 , u1 , "yo !" , [com1 , com2] , new Date());

        localdb[0] = msg;
    }

    function init()
    {
        noConnection = true;
        env = new Object();
        env.key = "abcd";
        env.idUser = 1;
        setVirtualdb();
        $("#messages").append(localdb[0].getHTML());
        $("#messages").append(localdb[0].getHTML());
        $("#messages").append(localdb[0].getHTML());
        $("#messages").append(localdb[0].getHTML());


    }

    function makeMainPanel(fromId , fromLogin , query){
        env.message = []
        if(fromId == undefined){
            fromId = -1
        }
        env.fromLogin = fromLogin;
        s=""
        /*if(env.fromId < 0)
        {
            s+=localdb[0].
        }*/
    }

</script>

<body onload="javascript: init()">
    <header>
    	<div id="header">
            <div id="logo"><img id="logo_img" src="image/logo.png" alt="logo"><span id="title">Twister</span></div>
            <div id="deconnexion"><input type="button" value="Deconnexion" onclick=""></div>
            <div id="search"><label class="hidden" for="input_search"></label><input id="input_search" type="text" name="search" placeholder="Rechercher un ami ou un message"/>
                <input type="button" value="Search" onclick="javascript:(function (){return;})()">
            </div>
    	</div>
    </header>
    <div id="stat"> je suis une stat</div>
    <div id="principale">
        <div id="nouveau_msg">
        	<input id="new_msg" type="text" name="new_message" placeholder="Ecrire un nouveau message">
        </div>
        <div id="container">
            <div id="messages">
                <div class="msg">
                    <span>je suis un msg</span>
                </div>
            </div>
        </div>

    </div>
    <footer>
        Fodil Zaki - Ghallab Karim
        <div class="lien_github" onclick=" window.open('https://github.com/PaulMorgon/Projet_3I017/', '_blank');">
            <svg height="24" viewBox="0 0 16 16" version="1.1" width="24" aria-hidden="true" id="logo_github">
                <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
            </svg>
        </div>
    </footer>
    
    <!-- Script pour que la zone de création de message colle au haut de l'écran -->
    <script type="text/javascript">
        window.onscroll = function() {myFunction()};

        var header = document.getElementById("new_msg");
        var sticky = header.offsetTop;

        function myFunction()
        {
            if (window.pageYOffset >= sticky - 10){      // 10 est la valeur du margin-bottom du header
                header.classList.add("sticky");
            }
            else {
                header.classList.remove("sticky");
            }
        }
    </script>
</body>
</html>